<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SentenceFlow - ì™¸ì› ëŠ”ë° ì…ì—ì„œ ì•ˆ ë‚˜ì˜¤ëŠ” ì˜ì–´, ì´ì œ ëë‚´ì„¸ìš”</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: { 50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81' },
            safe: '#22c55e', warn: '#f59e0b', danger: '#ef4444',
          },
          fontFamily: { sans: ['"Noto Sans KR"','system-ui','sans-serif'] }
        }
      }
    }
  </script>
  <style>
    body{font-family:'Noto Sans KR',system-ui,sans-serif;-webkit-tap-highlight-color:transparent}
    *{box-sizing:border-box}
    .fade-in{animation:fadeIn .3s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .pop{animation:pop .3s cubic-bezier(.175,.885,.32,1.275)}
    @keyframes pop{0%{transform:scale(.8);opacity:0}100%{transform:scale(1);opacity:1}}
    .shake{animation:shake .4s ease}
    @keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-4px)}40%,80%{transform:translateX(4px)}}
    .slide-up{animation:slideUp .25s ease-out}
    @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .glow{box-shadow:0 0 20px rgba(99,102,241,.3)}
    .dark .glow{box-shadow:0 0 20px rgba(129,140,248,.2)}
    input:focus,textarea:focus,button:focus{outline:none}
    ::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#c7d2fe;border-radius:2px}
    .dark ::-webkit-scrollbar-thumb{background:#4338ca}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback,useMemo}=React;

// ============================================================
// DATA: 30 sentences (10 per category) with chunks & teaching
// ============================================================
const SENTENCES=[
  // === Daily ===
  {id:1,cat:'daily',en:"I've been looking forward to meeting you.",ko:"ë§Œë‚˜ ëµ™ê¸°ë¥¼ ê¸°ëŒ€í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.",chunks:[["I've been","ë‚˜ëŠ” ~í•´ì™”ë‹¤"],["looking forward to","ê¸°ëŒ€í•˜ë‹¤"],["meeting you","ë§Œë‚˜ëŠ” ê²ƒì„"]],tip:"ë¹„ì¦ˆë‹ˆìŠ¤ ì²«ì¸ì‚¬. 'look forward to' ë’¤ì—ëŠ” í•­ìƒ -ing(ë™ëª…ì‚¬)ê°€ ì˜µë‹ˆë‹¤.",difficulty:2},
  {id:2,cat:'daily',en:"Could you do me a favor?",ko:"ë¶€íƒ í•˜ë‚˜ í•´ë„ ë ê¹Œìš”?",chunks:[["Could you","~í•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”"],["do me","ë‚˜ì—ê²Œ í•´ì£¼ë‹¤"],["a favor","ë¶€íƒ í•˜ë‚˜"]],tip:"ì •ì¤‘í•œ ë¶€íƒ í‘œí˜„. 'Can you' ë³´ë‹¤ ê²©ì‹ ìˆìŠµë‹ˆë‹¤.",difficulty:1},
  {id:3,cat:'daily',en:"I'm sorry, but something came up.",ko:"ì£„ì†¡í•œë°, ê°‘ìê¸° ì¼ì´ ìƒê²¼ì–´ìš”.",chunks:[["I'm sorry, but","ì£„ì†¡í•˜ì§€ë§Œ"],["something","ë¬´ì–¸ê°€ê°€"],["came up","ìƒê²¼ë‹¤/ë°œìƒí–ˆë‹¤"]],tip:"ì•½ì† ì·¨ì†Œ ì‹œ ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„. 'come up'ì€ ì˜ˆìƒì¹˜ ëª»í•œ ì¼ì´ ìƒê¸¸ ë•Œ ì”ë‹ˆë‹¤.",difficulty:1},
  {id:4,cat:'daily',en:"It totally slipped my mind.",ko:"ì™„ì „íˆ ê¹œë¹¡í–ˆì–´ìš”.",chunks:[["It","ê·¸ê²ƒì´"],["totally slipped","ì™„ì „íˆ ë¹ ì ¸ë‚˜ê°”ë‹¤"],["my mind","ë‚´ ë§ˆìŒì—ì„œ"]],tip:"ê¹Œë¨¹ì—ˆì„ ë•Œ ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„. 'I forgot' ë³´ë‹¤ ì›ì–´ë¯¼ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.",difficulty:2},
  {id:5,cat:'daily',en:"I'll keep that in mind.",ko:"ê·¸ê±° ê¸°ì–µí•´ ë‘˜ê²Œìš”.",chunks:[["I'll keep","ë‚˜ëŠ” ìœ ì§€í• ê²Œ"],["that","ê·¸ê²ƒì„"],["in mind","ë§ˆìŒì†ì—"]],tip:"ì¡°ì–¸ì„ ë°›ì•˜ì„ ë•Œ ê°ì‚¬í•˜ë©° ì“°ëŠ” í‘œí˜„.",difficulty:1},
  {id:6,cat:'daily',en:"Let me get back to you on that.",ko:"ê·¸ê±´ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì•Œë ¤ë“œë¦´ê²Œìš”.",chunks:[["Let me","ì œê°€ ~í• ê²Œìš”"],["get back to you","ë‹¤ì‹œ ì—°ë½í•˜ë‹¤"],["on that","ê·¸ê²ƒì— ëŒ€í•´"]],tip:"ì¦‰ë‹µì´ ì–´ë ¤ìš¸ ë•Œ ì‹œê°„ì„ ë²„ëŠ” í•µì‹¬ í‘œí˜„.",difficulty:2},
  {id:7,cat:'daily',en:"That's not what I meant.",ko:"ì œê°€ ë§í•˜ë ¤ë˜ ê±´ ê·¸ê²Œ ì•„ë‹ˆì—ìš”.",chunks:[["That's not","ê·¸ê±´ ~ì´ ì•„ë‹ˆë‹¤"],["what I meant","ë‚´ê°€ ì˜ë¯¸í–ˆë˜ ê²ƒ"]],tip:"ì˜¤í•´ê°€ ìƒê²¼ì„ ë•Œ ë°”ë¡œì¡ëŠ” í‘œí˜„.",difficulty:2},
  {id:8,cat:'daily',en:"I'm not really in the mood for that.",ko:"ì§€ê¸ˆ ê·¸ëŸ´ ê¸°ë¶„ì´ ì•„ë‹ˆì—ìš”.",chunks:[["I'm not really","ì‚¬ì‹¤ ~ì´ ì•„ë‹ˆì—ìš”"],["in the mood","ê¸°ë¶„ì´ ë‚˜ëŠ”"],["for that","ê·¸ê²ƒì— ëŒ€í•´"]],tip:"ë¶€ë“œëŸ½ê²Œ ê±°ì ˆí•  ë•Œ. ì§ì ‘ì ì¸ 'No' ë³´ë‹¤ ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.",difficulty:2},
  {id:9,cat:'daily',en:"It's on the tip of my tongue.",ko:"ì… ëì—ì„œ ë§´ë„ëŠ”ë° ìƒê°ì´ ì•ˆ ë‚˜ìš”.",chunks:[["It's on","~ì— ìˆë‹¤"],["the tip of","ëì—"],["my tongue","ë‚´ í˜€ì˜"]],tip:"ë­”ê°€ ë– ì˜¤ë¥¼ ë“¯ ì•ˆ ë– ì˜¤ë¥¼ ë•Œ. ì˜ì–´ í•™ìŠµìê°€ ìì£¼ ê²ªëŠ” ë°”ë¡œ ê·¸ ìˆœê°„!",difficulty:2},
  {id:10,cat:'daily',en:"I couldn't agree with you more.",ko:"ì™„ì „íˆ ë™ì˜í•©ë‹ˆë‹¤.",chunks:[["I couldn't","ë‚˜ëŠ” ~í•  ìˆ˜ ì—†ë‹¤"],["agree with you","ë‹¹ì‹ ì—ê²Œ ë™ì˜í•˜ë‹¤"],["more","ë” ì´ìƒ"]],tip:"ì´ì¤‘ë¶€ì • ê°•ì¡° í‘œí˜„. 'ë” ì´ìƒ ë™ì˜í•  ìˆ˜ ì—†ì„ ì •ë„ë¡œ ë™ì˜í•œë‹¤' = ì™„ì „ ë™ì˜.",difficulty:3},
  // === Business ===
  {id:11,cat:'business',en:"Let's circle back to this later.",ko:"ì´ê±´ ë‚˜ì¤‘ì— ë‹¤ì‹œ ë…¼ì˜í•©ì‹œë‹¤.",chunks:[["Let's","~í•©ì‹œë‹¤"],["circle back","ë‹¤ì‹œ ëŒì•„ì˜¤ë‹¤"],["to this later","ì´ê²ƒì— ë‚˜ì¤‘ì—"]],tip:"íšŒì˜ ì¤‘ ì£¼ì œë¥¼ ë¯¸ë£° ë•Œ. ë¯¸êµ­ ê¸°ì—…ë¬¸í™” í•„ìˆ˜ í‘œí˜„.",difficulty:2},
  {id:12,cat:'business',en:"I'd like to touch base with you.",ko:"ê°„ë‹¨íˆ ìƒí™© ê³µìœ í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.",chunks:[["I'd like to","~í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤"],["touch base","ì—°ë½í•˜ë‹¤/ìƒí™© ê³µìœ í•˜ë‹¤"],["with you","ë‹¹ì‹ ê³¼"]],tip:"ì•¼êµ¬ì—ì„œ ìœ ë˜. ì§§ì€ ë¯¸íŒ…/ì²´í¬ì¸ì„ ìš”ì²­í•  ë•Œ.",difficulty:2},
  {id:13,cat:'business',en:"We need to get everyone on the same page.",ko:"ëª¨ë‘ê°€ ê°™ì€ ì´í•´ë¥¼ í•˜ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤.",chunks:[["We need to","ìš°ë¦¬ëŠ” ~í•´ì•¼ í•œë‹¤"],["get everyone","ëª¨ë‘ë¥¼ ~í•˜ê²Œ í•˜ë‹¤"],["on the same page","ê°™ì€ í˜ì´ì§€ì—"]],tip:"íŒ€ ì •ë ¬ì´ í•„ìš”í•  ë•Œ. í”„ë¡œì íŠ¸ í‚¥ì˜¤í”„ì—ì„œ ìì£¼ ì‚¬ìš©.",difficulty:3},
  {id:14,cat:'business',en:"Could you walk me through the process?",ko:"ê·¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì„¤ëª…í•´ ì£¼ì‹œê² ì–´ìš”?",chunks:[["Could you","~í•´ì£¼ì‹œê² ì–´ìš”"],["walk me through","ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•˜ë‹¤"],["the process","ê·¸ ê³¼ì •ì„"]],tip:"'explain'ë³´ë‹¤ ìì—°ìŠ¤ëŸ¬ìš´ ë¹„ì¦ˆë‹ˆìŠ¤ í‘œí˜„. ë‹¨ê³„ë³„ ì„¤ëª…ì„ ìš”ì²­í•  ë•Œ.",difficulty:2},
  {id:15,cat:'business',en:"I'll keep you posted on any updates.",ko:"ì—…ë°ì´íŠ¸ê°€ ìˆìœ¼ë©´ ê³„ì† ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",chunks:[["I'll keep","~ë¥¼ ìœ ì§€í•˜ê² ë‹¤"],["you posted","ë‹¹ì‹ ì—ê²Œ ì•Œë¦¼ì„"],["on any updates","ì–´ë–¤ ì—…ë°ì´íŠ¸ë“ "]],tip:"ì§„í–‰ ìƒí™©ì„ ê³µìœ í•˜ê² ë‹¤ëŠ” ì•½ì†. ì´ë©”ì¼ ë§ˆë¬´ë¦¬ì— ìì£¼ ì‚¬ìš©.",difficulty:2},
  {id:16,cat:'business',en:"Let me play devil's advocate for a moment.",ko:"ì ì‹œ ë°˜ëŒ€ ì…ì¥ì—ì„œ ë§í•´ë³¼ê²Œìš”.",chunks:[["Let me play","ì œê°€ ~ì—­í• ì„ í• ê²Œìš”"],["devil's advocate","ì•…ë§ˆì˜ ì˜¹í˜¸ì"],["for a moment","ì ì‹œ"]],tip:"íšŒì˜ì—ì„œ ì˜ë„ì ìœ¼ë¡œ ë°˜ë¡ ì„ ì œê¸°í•  ë•Œ. ë¹„íŒì´ ì•„ë‹Œ ê±´ì„¤ì  í† ë¡  ë„êµ¬.",difficulty:3},
  {id:17,cat:'business',en:"We're running behind schedule.",ko:"ì¼ì •ë³´ë‹¤ ë’¤ì²˜ì§€ê³  ìˆìŠµë‹ˆë‹¤.",chunks:[["We're running","ìš°ë¦¬ëŠ” ~í•˜ê³  ìˆë‹¤"],["behind","ë’¤ì—"],["schedule","ì¼ì •"]],tip:"í”„ë¡œì íŠ¸ ì§€ì—°ì„ ì•Œë¦´ ë•Œ. 'late'ë³´ë‹¤ ì „ë¬¸ì ì¸ í‘œí˜„.",difficulty:2},
  {id:18,cat:'business',en:"That's a bit outside the scope of this meeting.",ko:"ê·¸ê±´ ì´ íšŒì˜ì˜ ë²”ìœ„ë¥¼ ë²—ì–´ë‚©ë‹ˆë‹¤.",chunks:[["That's a bit","ê·¸ê±´ ì•½ê°„"],["outside the scope","ë²”ìœ„ ë°–ì˜"],["of this meeting","ì´ íšŒì˜ì˜"]],tip:"íšŒì˜ê°€ ì‚°ìœ¼ë¡œ ê°ˆ ë•Œ ì£¼ì œë¥¼ ë˜ëŒë¦¬ëŠ” í‘œí˜„.",difficulty:3},
  {id:19,cat:'business',en:"I think we should take a step back and look at the bigger picture.",ko:"í•œ ë°œ ë¬¼ëŸ¬ì„œì„œ í° ê·¸ë¦¼ì„ ë´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.",chunks:[["I think we should","~í•´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤"],["take a step back","í•œ ë°œ ë¬¼ëŸ¬ì„œë‹¤"],["and look at the bigger picture","ê·¸ë¦¬ê³  í° ê·¸ë¦¼ì„ ë³´ë‹¤"]],tip:"ì„¸ë¶€ì‚¬í•­ì— ë§¤ëª°ëì„ ë•Œ. ì „ëµì  ì‹œê°ì„ í™˜ê¸°ì‹œí‚¤ëŠ” í‘œí˜„.",difficulty:3},
  {id:20,cat:'business',en:"Let's table this discussion for now.",ko:"ì´ ë…¼ì˜ëŠ” ì¼ë‹¨ ë³´ë¥˜í•©ì‹œë‹¤.",chunks:[["Let's table","~ë¥¼ ë³´ë¥˜í•©ì‹œë‹¤"],["this discussion","ì´ ë…¼ì˜ë¥¼"],["for now","ì§€ê¸ˆì€"]],tip:"ë¯¸êµ­ì‹ ì˜ì–´ì—ì„œ 'table'ì€ 'ë³´ë¥˜í•˜ë‹¤'. ì˜êµ­ì‹ì—ì„œëŠ” ë°˜ëŒ€ë¡œ 'ì œì•ˆí•˜ë‹¤'!",difficulty:2},
  // === Travel ===
  {id:21,cat:'travel',en:"Is there anywhere you'd recommend around here?",ko:"ì´ ê·¼ì²˜ì— ì¶”ì²œí•´ì£¼ì‹¤ ê³³ ìˆë‚˜ìš”?",chunks:[["Is there anywhere","ì–´ë”˜ê°€ ìˆë‚˜ìš”"],["you'd recommend","ë‹¹ì‹ ì´ ì¶”ì²œí• "],["around here","ì´ ê·¼ì²˜ì—"]],tip:"í˜„ì§€ì¸ì—ê²Œ ë§›ì§‘/ëª…ì†Œë¥¼ ë¬¼ì„ ë•Œ ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„.",difficulty:2},
  {id:22,cat:'travel',en:"I'd like to check in, please.",ko:"ì²´í¬ì¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.",chunks:[["I'd like to","~í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤"],["check in","ì²´í¬ì¸í•˜ë‹¤"],["please","ë¶€íƒë“œë¦½ë‹ˆë‹¤"]],tip:"í˜¸í…”/ê³µí•­ì—ì„œ í•„ìˆ˜. 'I want to' ë³´ë‹¤ ì •ì¤‘í•©ë‹ˆë‹¤.",difficulty:1},
  {id:23,cat:'travel',en:"Could you take a picture of us?",ko:"ì €í¬ ì‚¬ì§„ ì¢€ ì°ì–´ì£¼ì‹œê² ì–´ìš”?",chunks:[["Could you","~í•´ì£¼ì‹œê² ì–´ìš”"],["take a picture","ì‚¬ì§„ì„ ì°ë‹¤"],["of us","ì €í¬ì˜"]],tip:"ê´€ê´‘ì§€ì—ì„œ ìì£¼ ì“°ëŠ” í‘œí˜„. 'photo'ë¡œ ë°”ê¿”ì¨ë„ ë©ë‹ˆë‹¤.",difficulty:1},
  {id:24,cat:'travel',en:"How long does it take to get there?",ko:"ê±°ê¸°ê¹Œì§€ ì–¼ë§ˆë‚˜ ê±¸ë¦¬ë‚˜ìš”?",chunks:[["How long","ì–¼ë§ˆë‚˜ ì˜¤ë˜"],["does it take","ê±¸ë¦¬ë‚˜ìš”"],["to get there","ê±°ê¸°ì— ë„ì°©í•˜ëŠ” ë°"]],tip:"êµí†µìˆ˜ë‹¨/ì´ë™ì‹œê°„ì„ ë¬¼ì„ ë•Œ í•„ìˆ˜ í‘œí˜„.",difficulty:1},
  {id:25,cat:'travel',en:"I'm allergic to peanuts. Does this contain any?",ko:"ì €ëŠ” ë•…ì½© ì•Œë ˆë¥´ê¸°ê°€ ìˆì–´ìš”. ì´ê±° ë“¤ì–´ìˆë‚˜ìš”?",chunks:[["I'm allergic to","~ì— ì•Œë ˆë¥´ê¸°ê°€ ìˆë‹¤"],["peanuts","ë•…ì½©"],["Does this contain any","ì´ê²ƒì— ë“¤ì–´ìˆë‚˜ìš”"]],tip:"ì‹ë‹¹ì—ì„œ ì•ˆì „ì„ ìœ„í•œ í•„ìˆ˜ í‘œí˜„. 'peanuts'ë¥¼ ë‹¤ë¥¸ ì•Œë ˆë¥´ê¸° ì›ì¸ìœ¼ë¡œ êµì²´ ê°€ëŠ¥.",difficulty:2},
  {id:26,cat:'travel',en:"We're a party of four. Do you have a table available?",ko:"4ëª…ì¸ë°ìš”, ìë¦¬ ìˆë‚˜ìš”?",chunks:[["We're a party of four","ìš°ë¦¬ëŠ” 4ì¸ ì¼í–‰ì…ë‹ˆë‹¤"],["Do you have","~ê°€ ìˆë‚˜ìš”"],["a table available","ì´ìš© ê°€ëŠ¥í•œ í…Œì´ë¸”"]],tip:"ë ˆìŠ¤í† ë‘ ì˜ˆì•½ ì—†ì´ ê°ˆ ë•Œ. 'party'ëŠ” ì—¬ê¸°ì„œ 'ì¼í–‰'ì´ë¼ëŠ” ëœ».",difficulty:2},
  {id:27,cat:'travel',en:"Excuse me, I think you gave me the wrong change.",ko:"ì‹¤ë¡€í•©ë‹ˆë‹¤, ê±°ìŠ¤ë¦„ëˆì´ ì˜ëª»ëœ ê²ƒ ê°™ì•„ìš”.",chunks:[["Excuse me","ì‹¤ë¡€í•©ë‹ˆë‹¤"],["I think you gave me","~ë¥¼ ì£¼ì‹  ê²ƒ ê°™ì•„ìš”"],["the wrong change","ì˜ëª»ëœ ê±°ìŠ¤ë¦„ëˆ"]],tip:"ê³µì†í•˜ê²Œ ì‹¤ìˆ˜ë¥¼ ì§€ì í•  ë•Œ. 'I think'ì„ ë„£ìœ¼ë©´ ë¶€ë“œëŸ¬ì›Œì§‘ë‹ˆë‹¤.",difficulty:2},
  {id:28,cat:'travel',en:"Is this seat taken?",ko:"ì´ ìë¦¬ ë¹„ì–´ìˆë‚˜ìš”?",chunks:[["Is this seat","ì´ ì¢Œì„ì´"],["taken","ì°¨ì§€ëœ/ì‚¬ìš© ì¤‘ì¸"]],tip:"ì¹´í˜, ê¸°ì°¨, ê³µí•­ ë“± ì–´ë””ì„œë‚˜ ì“¸ ìˆ˜ ìˆëŠ” ì§§ê³  ê°•ë ¥í•œ í‘œí˜„.",difficulty:1},
  {id:29,cat:'travel',en:"I got lost. Could you point me in the right direction?",ko:"ê¸¸ì„ ìƒì—ˆì–´ìš”. ë°©í–¥ì„ ì•Œë ¤ì£¼ì‹œê² ì–´ìš”?",chunks:[["I got lost","ê¸¸ì„ ìƒì—ˆë‹¤"],["Could you point me","ì €ë¥¼ ê°€ë¦¬ì¼œ ì£¼ì‹œê² ì–´ìš”"],["in the right direction","ì˜¬ë°”ë¥¸ ë°©í–¥ìœ¼ë¡œ"]],tip:"GPSê°€ ì•ˆ ë  ë•Œ í˜„ì§€ì¸ì—ê²Œ ë„ì›€ ìš”ì²­. 'point'ëŠ” ë°©í–¥ì„ ê°€ë¦¬í‚¤ë‹¤.",difficulty:2},
  {id:30,cat:'travel',en:"What time is the last train back?",ko:"ëŒì•„ê°€ëŠ” ë§ˆì§€ë§‰ ê¸°ì°¨ê°€ ëª‡ ì‹œì¸ê°€ìš”?",chunks:[["What time is","ëª‡ ì‹œì¸ê°€ìš”"],["the last train","ë§ˆì§€ë§‰ ê¸°ì°¨ê°€"],["back","ëŒì•„ê°€ëŠ”"]],tip:"ì—¬í–‰ì§€ì—ì„œ êµí†µí¸ í™•ì¸ í•„ìˆ˜. 'train'ì„ 'bus/ferry'ë¡œ êµì²´ ê°€ëŠ¥.",difficulty:1},
];

const CATS={daily:{label:'ì¼ìƒ',emoji:'ğŸ’¬',color:'indigo'},business:{label:'ë¹„ì¦ˆë‹ˆìŠ¤',emoji:'ğŸ’¼',color:'emerald'},travel:{label:'ì—¬í–‰',emoji:'âœˆï¸',color:'amber'}};

// ============================================================
// SM-2 Spaced Repetition helpers
// ============================================================
function sm2(item,quality){
  let {ef=2.5,interval=1,reps=0}=item;
  if(quality>=3){reps++;if(reps===1)interval=1;else if(reps===2)interval=3;else interval=Math.round(interval*ef);ef=Math.max(1.3,ef+(.1-(.08+(5-quality)*(.02+(5-quality)*.015))));}
  else{reps=0;interval=1;}
  return{ef,interval,reps,nextReview:Date.now()+interval*86400000};
}

function getMemoryStrength(item){
  if(!item.lastStudied)return 'new';
  const daysSince=(Date.now()-item.lastStudied)/86400000;
  const ratio=daysSince/(item.interval||1);
  if(ratio<.5)return 'strong';if(ratio<1)return 'medium';return 'weak';
}

// ============================================================
// Utility
// ============================================================
const uid=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,6);
const clamp=(n,lo,hi)=>Math.min(hi,Math.max(lo,n));
const shuffle=a=>[...a].sort(()=>Math.random()-.5);

// ============================================================
// STORAGE
// ============================================================
function loadData(){
  try{return JSON.parse(localStorage.getItem('sf-data'))||{}}catch{return{}}
}
function saveData(d){localStorage.setItem('sf-data',JSON.stringify(d))}

function useStore(){
  const[data,setDataRaw]=useState(()=>{
    const d=loadData();
    if(!d.progress)d.progress={};
    if(!d.streak)d.streak={current:0,best:0,lastDate:null};
    if(!d.sessions)d.sessions=[];
    if(!d.dark)d.dark=window.matchMedia?.('(prefers-color-scheme:dark)').matches||false;
    return d;
  });
  const setData=useCallback(fn=>{
    setDataRaw(prev=>{const next=typeof fn==='function'?fn(prev):{...prev,...fn};saveData(next);return next;});
  },[]);
  return[data,setData];
}

// ============================================================
// COMPONENTS
// ============================================================

function DarkToggle({dark,toggle}){
  return <button onClick={toggle} className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
    {dark?<svg className="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clipRule="evenodd"/></svg>
    :<svg className="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>}
  </button>;
}

// --- Landing Page ---
function Landing({onStart}){
  const pains=["ì™¸êµ­ì¸ ì•ì—ì„œ ì•„ëŠ” ë¬¸ì¥ë„ ì…ì—ì„œ ì•ˆ ë‚˜ì˜¨ ì  ìˆë‹¤","ì˜ì–´ ë¬¸ì¥ì„ ì™¸ì›Œë„ ë‹¤ìŒ ë‚ ì´ë©´ ê¹Œë¨¹ëŠ”ë‹¤","ì½ìœ¼ë©´ ì´í•´ë˜ëŠ”ë° ì§ì ‘ ë§í•˜ë ¤ë©´ ë§‰íŒë‹¤"];
  const[checked,setChecked]=useState([]);
  const toggle=i=>setChecked(p=>p.includes(i)?p.filter(x=>x!==i):[...p,i]);
  return <div className="min-h-screen flex flex-col items-center justify-center px-6 fade-in">
    <div className="text-5xl mb-4">ğŸ§ </div>
    <h1 className="text-2xl md:text-3xl font-extrabold text-gray-900 dark:text-white text-center leading-tight mb-3">
      ì™¸ì› ëŠ”ë° ì…ì—ì„œ<br/>ì•ˆ ë‚˜ì˜¤ëŠ” ì˜ì–´,<br/><span className="text-brand-500">ì´ì œ ëë‚´ì„¸ìš”.</span>
    </h1>
    <p className="text-sm text-gray-500 dark:text-gray-400 text-center mb-8 max-w-sm">ì½ìœ¼ë©´ ì•„ëŠ”ë° ë§í•˜ë©´ ëª¨ë¥´ëŠ” ë¬¸ì¥ë“¤.<br/>í•˜ë£¨ 7ë¶„ì´ë©´ ì…ì—ì„œ ìë™ìœ¼ë¡œ ë‚˜ì˜µë‹ˆë‹¤.</p>
    <div className="w-full max-w-sm space-y-3 mb-8">
      <p className="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider">í˜¹ì‹œ ì´ëŸ° ê²½í—˜ ìˆìœ¼ì„¸ìš”?</p>
      {pains.map((p,i)=><label key={i} className={`flex items-start gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${checked.includes(i)?'border-brand-400 bg-brand-50 dark:bg-brand-900/20 dark:border-brand-500':'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'}`}>
        <input type="checkbox" checked={checked.includes(i)} onChange={()=>toggle(i)} className="mt-0.5 accent-brand-500"/>
        <span className="text-sm text-gray-700 dark:text-gray-300">{p}</span>
      </label>)}
    </div>
    <button onClick={onStart} className="w-full max-w-sm py-4 rounded-2xl bg-brand-500 hover:bg-brand-600 text-white font-bold text-base shadow-lg hover:shadow-xl transition-all glow">
      {checked.length>0?'ì§€ê¸ˆ ë°”ë¡œ í•´ê²°í•´ë³¼ê²Œìš”':'ë¬´ë£Œë¡œ ì²´í—˜í•˜ê¸°'}
    </button>
    <p className="text-xs text-gray-400 dark:text-gray-500 mt-3">íšŒì›ê°€ì… ì—†ì´ ë°”ë¡œ ì‹œì‘</p>
  </div>;
}

// --- Home Dashboard ---
function Home({data,onStartSession,onShowList}){
  const progress=data.progress||{};
  const entries=Object.values(progress);
  const strong=entries.filter(e=>getMemoryStrength(e)==='strong').length;
  const medium=entries.filter(e=>getMemoryStrength(e)==='medium').length;
  const weak=entries.filter(e=>getMemoryStrength(e)==='weak').length;
  const newCount=SENTENCES.length-entries.length;
  const reviewDue=entries.filter(e=>!e.nextReview||e.nextReview<=Date.now()).length;
  const totalMastered=entries.filter(e=>(e.level||0)>=5).length;
  const streak=data.streak||{current:0,best:0};
  const avgSpeed=entries.length?Math.round(entries.reduce((s,e)=>s+(e.avgRecall||10),0)/entries.length*10)/10:0;

  return <div className="fade-in space-y-5">
    <div className="text-center pt-2">
      <p className="text-sm text-gray-500 dark:text-gray-400">ì¢‹ì€ í•˜ë£¨ì—ìš”! ğŸ¯</p>
      <p className="text-xs text-gray-400 dark:text-gray-500 mt-1">
        {streak.current>0?`${streak.current}ì¼ ì—°ì† í•™ìŠµ ì¤‘!`:'ì˜¤ëŠ˜ ì²« í•™ìŠµì„ ì‹œì‘í•´ë³´ì„¸ìš”'}
      </p>
    </div>

    {/* Session Card */}
    <div className="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
      <div className="flex justify-between items-center mb-4">
        <span className="text-sm font-semibold text-gray-800 dark:text-gray-100">ì˜¤ëŠ˜ì˜ í•™ìŠµ</span>
        <span className="text-xs text-gray-400 dark:text-gray-500">ì•½ {Math.max(3,Math.ceil((reviewDue+3)*0.6))}ë¶„ ì†Œìš”</span>
      </div>
      <div className="flex gap-4 mb-5">
        <div className="flex-1 bg-brand-50 dark:bg-brand-900/20 rounded-xl p-3 text-center">
          <p className="text-2xl font-bold text-brand-600 dark:text-brand-400">{reviewDue}</p>
          <p className="text-xs text-gray-500 dark:text-gray-400">ë³µìŠµ</p>
        </div>
        <div className="flex-1 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl p-3 text-center">
          <p className="text-2xl font-bold text-emerald-600 dark:text-emerald-400">{Math.min(3,newCount)}</p>
          <p className="text-xs text-gray-500 dark:text-gray-400">ìƒˆ ë¬¸ì¥</p>
        </div>
      </div>
      <button onClick={onStartSession} className="w-full py-3.5 rounded-xl bg-brand-500 hover:bg-brand-600 text-white font-bold transition-all shadow glow">
        ë°”ë¡œ ì‹œì‘
      </button>
    </div>

    {/* Memory Strength */}
    <div className="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-100 dark:border-gray-700">
      <p className="text-sm font-semibold text-gray-800 dark:text-gray-100 mb-3">ê¸°ì–µ ìƒíƒœ</p>
      <div className="flex gap-3">
        <div className="flex-1 text-center">
          <div className="text-lg font-bold text-safe">{strong}</div>
          <div className="text-[10px] text-gray-400">ê²¬ê³ </div>
          <div className="h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full mt-1"><div className="h-full bg-safe rounded-full" style={{width:`${entries.length?strong/SENTENCES.length*100:0}%`}}/></div>
        </div>
        <div className="flex-1 text-center">
          <div className="text-lg font-bold text-warn">{medium}</div>
          <div className="text-[10px] text-gray-400">í”ë“¤ë¦¼</div>
          <div className="h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full mt-1"><div className="h-full bg-warn rounded-full" style={{width:`${entries.length?medium/SENTENCES.length*100:0}%`}}/></div>
        </div>
        <div className="flex-1 text-center">
          <div className="text-lg font-bold text-danger">{weak}</div>
          <div className="text-[10px] text-gray-400">ìœ„í—˜</div>
          <div className="h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full mt-1"><div className="h-full bg-danger rounded-full" style={{width:`${entries.length?weak/SENTENCES.length*100:0}%`}}/></div>
        </div>
        <div className="flex-1 text-center">
          <div className="text-lg font-bold text-gray-300 dark:text-gray-600">{newCount}</div>
          <div className="text-[10px] text-gray-400">ë¯¸í•™ìŠµ</div>
          <div className="h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full mt-1"><div className="h-full bg-gray-300 dark:bg-gray-600 rounded-full" style={{width:`${newCount/SENTENCES.length*100}%`}}/></div>
        </div>
      </div>
    </div>

    {/* Stats */}
    <div className="grid grid-cols-3 gap-3">
      <div className="bg-white dark:bg-gray-800 rounded-xl p-3 text-center border border-gray-100 dark:border-gray-700">
        <p className="text-lg font-bold text-gray-800 dark:text-gray-100">{totalMastered}</p>
        <p className="text-[10px] text-gray-400">ì²´í™” ì™„ë£Œ</p>
      </div>
      <div className="bg-white dark:bg-gray-800 rounded-xl p-3 text-center border border-gray-100 dark:border-gray-700">
        <p className="text-lg font-bold text-gray-800 dark:text-gray-100">{avgSpeed}s</p>
        <p className="text-[10px] text-gray-400">í‰ê·  íšŒìƒ</p>
      </div>
      <div className="bg-white dark:bg-gray-800 rounded-xl p-3 text-center border border-gray-100 dark:border-gray-700">
        <p className="text-lg font-bold text-gray-800 dark:text-gray-100">{streak.best}</p>
        <p className="text-[10px] text-gray-400">ìµœì¥ ì—°ì†</p>
      </div>
    </div>

    {/* Sentence List Link */}
    <button onClick={onShowList} className="w-full py-3 text-sm text-brand-500 dark:text-brand-400 hover:underline">
      ë‚´ ë¬¸ì¥ ëª©ë¡ ë³´ê¸° ({entries.length}/{SENTENCES.length})
    </button>
  </div>;
}

// --- Sentence List ---
function SentenceList({data,onBack}){
  const progress=data.progress||{};
  const[filter,setFilter]=useState('all');
  const filtered=SENTENCES.filter(s=>filter==='all'||s.cat===filter);
  return <div className="fade-in">
    <div className="flex items-center gap-3 mb-4">
      <button onClick={onBack} className="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7"/></svg>
      </button>
      <h2 className="text-lg font-bold text-gray-800 dark:text-gray-100">ë‚´ ë¬¸ì¥</h2>
    </div>
    <div className="flex gap-2 mb-4 overflow-x-auto pb-1">
      {[['all','ì „ì²´'],['daily','ì¼ìƒ'],['business','ë¹„ì¦ˆë‹ˆìŠ¤'],['travel','ì—¬í–‰']].map(([k,l])=>
        <button key={k} onClick={()=>setFilter(k)} className={`px-3 py-1.5 text-xs font-medium rounded-lg whitespace-nowrap transition-colors ${filter===k?'bg-brand-500 text-white':'bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400'}`}>{l}</button>
      )}
    </div>
    <div className="space-y-2">
      {filtered.map(s=>{
        const p=progress[s.id]||{};
        const str=getMemoryStrength(p);
        const lvl=p.level||0;
        const colors={strong:'bg-safe',medium:'bg-warn',weak:'bg-danger',new:'bg-gray-300 dark:bg-gray-600'};
        return <div key={s.id} className="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-100 dark:border-gray-700 slide-up">
          <div className="flex items-start justify-between gap-2">
            <div className="flex-1 min-w-0">
              <p className="text-sm font-medium text-gray-800 dark:text-gray-100 truncate">{s.en}</p>
              <p className="text-xs text-gray-400 dark:text-gray-500 mt-0.5">{s.ko}</p>
            </div>
            <div className="flex items-center gap-2 shrink-0">
              <div className="flex gap-0.5">{[1,2,3,4,5].map(i=><div key={i} className={`w-1.5 h-4 rounded-full ${i<=lvl?'bg-brand-400':'bg-gray-200 dark:bg-gray-700'}`}/>)}</div>
              <div className={`w-2 h-2 rounded-full ${colors[str]}`}/>
            </div>
          </div>
        </div>;
      })}
    </div>
  </div>;
}

// --- Learning Session ---
function LearningSession({data,setData,onFinish}){
  const progress=data.progress||{};

  // Build queue: review due + new sentences
  const queue=useMemo(()=>{
    const review=SENTENCES.filter(s=>{const p=progress[s.id];return p&&p.nextReview&&p.nextReview<=Date.now();});
    const newS=SENTENCES.filter(s=>!progress[s.id]);
    const items=[...shuffle(review),...shuffle(newS).slice(0,3)];
    return items.length>0?items:shuffle(SENTENCES).slice(0,5);
  },[]);

  const[idx,setIdx]=useState(0);
  const[step,setStep]=useState(0); // 0:expose, 1:chunk, 2:fill, 3:fullRecall, 4:result
  const[hintLevel,setHintLevel]=useState(0);
  const[answer,setAnswer]=useState('');
  const[fillAnswers,setFillAnswers]=useState({});
  const[startTime,setStartTime]=useState(Date.now());
  const[recallTime,setRecallTime]=useState(0);
  const[correct,setCorrect]=useState(null);
  const[sessionResults,setSessionResults]=useState([]);
  const[showTip,setShowTip]=useState(false);
  const inputRef=useRef(null);

  const sentence=queue[idx];
  if(!sentence)return <SessionComplete results={sessionResults} data={data} onFinish={onFinish}/>;

  const totalSteps=queue.length;
  const progressPct=((idx)/totalSteps)*100;

  // Generate blanks for fill step
  const words=sentence.en.split(' ');
  const blankIndices=useMemo(()=>{
    const important=[];
    sentence.chunks.forEach(([chunk])=>{
      const cWords=chunk.split(' ');
      cWords.forEach(cw=>{const wi=words.findIndex((w,i)=>w.toLowerCase().replace(/[^a-z]/g,'')===cw.toLowerCase().replace(/[^a-z]/g,'')&&!important.includes(i));if(wi>=0)important.push(wi);});
    });
    return important.length>0?important.slice(0,Math.min(3,important.length)):[1,Math.floor(words.length/2)];
  },[idx]);

  const handleFillCheck=()=>{
    const allCorrect=blankIndices.every(bi=>{
      const userWord=(fillAnswers[bi]||'').trim().toLowerCase().replace(/[^a-z']/g,'');
      const correctWord=words[bi].toLowerCase().replace(/[^a-z']/g,'');
      return userWord===correctWord;
    });
    if(allCorrect){
      setStep(3);setStartTime(Date.now());setAnswer('');setHintLevel(0);
    }else{
      setCorrect(false);
      setTimeout(()=>setCorrect(null),600);
    }
  };

  const handleFullRecallCheck=()=>{
    const userClean=answer.trim().toLowerCase().replace(/[^a-z' ]/g,'').replace(/\s+/g,' ');
    const correctClean=sentence.en.toLowerCase().replace(/[^a-z' ]/g,'').replace(/\s+/g,' ');
    const elapsed=(Date.now()-startTime)/1000;
    if(userClean===correctClean){
      setRecallTime(elapsed);setCorrect(true);setStep(4);
      // Update progress
      const prev=progress[sentence.id]||{ef:2.5,interval:1,reps:0,recallTimes:[],level:0};
      const quality=hintLevel===0?5:hintLevel===1?4:3;
      const updated=sm2(prev,quality);
      const newRecalls=[...(prev.recallTimes||[]),elapsed].slice(-10);
      const newLevel=clamp((prev.level||0)+1,0,5);
      setData(d=>({...d,progress:{...d.progress,[sentence.id]:{...updated,lastStudied:Date.now(),recallTimes:newRecalls,avgRecall:Math.round(newRecalls.reduce((a,b)=>a+b,0)/newRecalls.length*10)/10,level:newLevel,hintsUsed:(prev.hintsUsed||0)+hintLevel}}}));
      setSessionResults(r=>[...r,{id:sentence.id,correct:true,time:elapsed,hints:hintLevel}]);
    }else{
      setCorrect(false);
      setTimeout(()=>setCorrect(null),600);
    }
  };

  const showHint=()=>setHintLevel(h=>Math.min(3,h+1));

  const nextSentence=()=>{
    setIdx(i=>i+1);setStep(0);setHintLevel(0);setAnswer('');setFillAnswers({});setCorrect(null);setShowTip(false);setStartTime(Date.now());
  };

  const skipWithPenalty=()=>{
    const prev=progress[sentence.id]||{ef:2.5,interval:1,reps:0,recallTimes:[],level:0};
    const updated=sm2(prev,1);
    setData(d=>({...d,progress:{...d.progress,[sentence.id]:{...updated,lastStudied:Date.now(),recallTimes:prev.recallTimes||[],avgRecall:prev.avgRecall||10,level:Math.max(0,(prev.level||0)-1),hintsUsed:(prev.hintsUsed||0)+3}}}));
    setSessionResults(r=>[...r,{id:sentence.id,correct:false,time:0,hints:3}]);
    nextSentence();
  };

  const catInfo=CATS[sentence.cat];

  return <div className="fade-in">
    {/* Progress bar */}
    <div className="flex items-center gap-3 mb-6">
      <button onClick={onFinish} className="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
      <div className="flex-1 h-2 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
        <div className="h-full bg-brand-400 rounded-full transition-all duration-500" style={{width:`${progressPct}%`}}/>
      </div>
      <span className="text-xs text-gray-400 font-medium">{idx+1}/{totalSteps}</span>
    </div>

    <div className="flex items-center gap-2 mb-4">
      <span className="text-xs px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400">{catInfo.emoji} {catInfo.label}</span>
      <span className="text-xs text-gray-300 dark:text-gray-600">
        {['ë¬¸ì¥ ë³´ê¸°','ì²­í¬ ë¶„í•´','ë¹ˆì¹¸ ì±„ìš°ê¸°','ì™„ì „ íšŒìƒ','ê²°ê³¼'][step]}
      </span>
    </div>

    {/* Step 0: Expose */}
    {step===0&&<div className="pop">
      <div className="bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-100 dark:border-gray-700 mb-4">
        <p className="text-xl font-bold text-gray-900 dark:text-white leading-relaxed mb-3">{sentence.en}</p>
        <p className="text-sm text-gray-500 dark:text-gray-400">{sentence.ko}</p>
      </div>
      <button onClick={()=>{
        if('speechSynthesis' in window){const u=new SpeechSynthesisUtterance(sentence.en);u.lang='en-US';u.rate=0.85;speechSynthesis.speak(u);}
      }} className="w-full py-3 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-sm font-medium mb-3 flex items-center justify-center gap-2">
        <span>ğŸ”Š</span> ë“£ê¸°
      </button>
      <button onClick={()=>setStep(1)} className="w-full py-3.5 rounded-xl bg-brand-500 text-white font-bold">ë‹¤ìŒ â†’</button>
    </div>}

    {/* Step 1: Chunking */}
    {step===1&&<div className="pop">
      <p className="text-xs text-gray-400 dark:text-gray-500 uppercase tracking-wider font-semibold mb-3">ì²­í¬ ë¶„í•´</p>
      <div className="space-y-2 mb-6">
        {sentence.chunks.map(([en,ko],i)=><div key={i} className="flex items-center gap-3 bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-100 dark:border-gray-700 slide-up" style={{animationDelay:`${i*100}ms`}}>
          <span className="text-base font-semibold text-brand-600 dark:text-brand-400">{en}</span>
          <span className="text-sm text-gray-400">=</span>
          <span className="text-sm text-gray-600 dark:text-gray-300">{ko}</span>
        </div>)}
      </div>
      <button onClick={()=>{setStep(2);setStartTime(Date.now());}} className="w-full py-3.5 rounded-xl bg-brand-500 text-white font-bold">ë¹ˆì¹¸ ì±„ìš°ê¸° â†’</button>
    </div>}

    {/* Step 2: Fill in blanks */}
    {step===2&&<div className={`pop ${correct===false?'shake':''}`}>
      <p className="text-xs text-gray-400 dark:text-gray-500 uppercase tracking-wider font-semibold mb-3">ë¹ˆì¹¸ì„ ì±„ìš°ì„¸ìš”</p>
      <div className="bg-white dark:bg-gray-800 rounded-2xl p-5 border border-gray-100 dark:border-gray-700 mb-4">
        <div className="flex flex-wrap gap-1.5 items-center">
          {words.map((w,i)=>blankIndices.includes(i)?
            <input key={i} type="text" value={fillAnswers[i]||''} onChange={e=>setFillAnswers({...fillAnswers,[i]:e.target.value})}
              placeholder={hintLevel>=1?w[0]+'___':'____'}
              className="w-24 border-b-2 border-brand-300 dark:border-brand-600 bg-transparent text-center text-base font-semibold text-gray-900 dark:text-white px-1 py-0.5 focus:border-brand-500"
              autoComplete="off" spellCheck="false"/>
            :<span key={i} className="text-base text-gray-800 dark:text-gray-200">{w}</span>
          )}
        </div>
        {hintLevel>=2&&<div className="mt-3 pt-3 border-t border-gray-100 dark:border-gray-700 space-y-1">
          {sentence.chunks.map(([en,ko],i)=><p key={i} className="text-xs text-gray-400"><span className="text-brand-500">{en}</span> = {ko}</p>)}
        </div>}
        {hintLevel>=3&&<p className="mt-2 text-sm text-brand-500 font-medium">{sentence.en}</p>}
      </div>
      <div className="flex gap-2">
        <button onClick={showHint} className="flex-1 py-3 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-sm font-medium">
          ğŸ’¡ íŒíŠ¸ ({hintLevel}/3)
        </button>
        <button onClick={handleFillCheck} className="flex-1 py-3 rounded-xl bg-brand-500 text-white font-bold text-sm">í™•ì¸</button>
      </div>
    </div>}

    {/* Step 3: Full Recall */}
    {step===3&&<div className={`pop ${correct===false?'shake':''}`}>
      <p className="text-xs text-gray-400 dark:text-gray-500 uppercase tracking-wider font-semibold mb-3">ì „ì²´ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”</p>
      <div className="bg-white dark:bg-gray-800 rounded-2xl p-5 border border-gray-100 dark:border-gray-700 mb-4">
        <p className="text-sm text-gray-400 dark:text-gray-500 mb-3">{sentence.ko}</p>
        <textarea ref={inputRef} value={answer} onChange={e=>setAnswer(e.target.value)} rows={3}
          className="w-full bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-base text-gray-900 dark:text-white resize-none border border-gray-200 dark:border-gray-600 focus:border-brand-400 dark:focus:border-brand-500"
          placeholder="ì˜ì–´ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”..." autoComplete="off" spellCheck="false"
          onKeyDown={e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleFullRecallCheck();}}}/>
        {hintLevel>=1&&<p className="text-xs text-gray-400 mt-2">ì²« ê¸€ì: {sentence.en.split(' ').map(w=>w[0]).join(' ')}</p>}
        {hintLevel>=2&&<div className="mt-2 space-y-1">{sentence.chunks.map(([en,ko],i)=><p key={i} className="text-xs text-gray-400"><span className="text-brand-500">{en}</span> = {ko}</p>)}</div>}
        {hintLevel>=3&&<p className="mt-2 text-sm text-brand-500 font-medium">{sentence.en}</p>}
      </div>
      <div className="flex gap-2">
        <button onClick={showHint} className="flex-1 py-3 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-sm font-medium">
          ğŸ’¡ íŒíŠ¸ ({hintLevel}/3)
        </button>
        <button onClick={handleFullRecallCheck} className="flex-1 py-3 rounded-xl bg-brand-500 text-white font-bold text-sm">í™•ì¸</button>
      </div>
      <button onClick={skipWithPenalty} className="w-full mt-2 py-2 text-xs text-gray-400 hover:text-gray-500">ê±´ë„ˆë›°ê¸°</button>
    </div>}

    {/* Step 4: Result */}
    {step===4&&<div className="pop text-center">
      <div className="text-4xl mb-3">âœ…</div>
      <p className="text-xl font-bold text-gray-900 dark:text-white mb-2">ì •í™•í•´ìš”!</p>
      <div className="bg-white dark:bg-gray-800 rounded-2xl p-5 border border-gray-100 dark:border-gray-700 mb-4 text-left">
        <p className="text-base font-semibold text-gray-900 dark:text-white mb-1">{sentence.en}</p>
        <p className="text-sm text-gray-400 mb-3">{sentence.ko}</p>
        <div className="flex gap-4 text-center py-2 border-t border-gray-100 dark:border-gray-700">
          <div className="flex-1"><p className="text-lg font-bold text-brand-500">{recallTime.toFixed(1)}s</p><p className="text-[10px] text-gray-400">íšŒìƒ ì‹œê°„</p></div>
          <div className="flex-1"><p className="text-lg font-bold text-gray-800 dark:text-gray-200">{hintLevel}</p><p className="text-[10px] text-gray-400">íŒíŠ¸ ì‚¬ìš©</p></div>
          <div className="flex-1">
            <div className="flex gap-0.5 justify-center">{[1,2,3,4,5].map(i=><div key={i} className={`w-1.5 h-4 rounded-full ${i<=(progress[sentence.id]?.level||1)?'bg-brand-400':'bg-gray-200 dark:bg-gray-700'}`}/>)}</div>
            <p className="text-[10px] text-gray-400 mt-1">ì²´í™” ë ˆë²¨</p>
          </div>
        </div>
      </div>
      <button onClick={()=>setShowTip(!showTip)} className="text-xs text-brand-500 mb-3 hover:underline">
        {showTip?'ì ‘ê¸°':'ğŸ“– ë¬¸ì¥ í•´ë¶€ ë³´ê¸°'}
      </button>
      {showTip&&<div className="bg-brand-50 dark:bg-brand-900/20 rounded-xl p-4 text-left mb-4 slide-up">
        <p className="text-sm text-gray-700 dark:text-gray-300">{sentence.tip}</p>
        <div className="mt-2 space-y-1">{sentence.chunks.map(([en,ko],i)=><p key={i} className="text-xs text-gray-500"><span className="font-medium text-brand-600 dark:text-brand-400">{en}</span> = {ko}</p>)}</div>
      </div>}
      <button onClick={nextSentence} className="w-full py-3.5 rounded-xl bg-brand-500 text-white font-bold">
        {idx<totalSteps-1?'ë‹¤ìŒ ë¬¸ì¥ â†’':'í•™ìŠµ ì™„ë£Œ'}
      </button>
    </div>}
  </div>;
}

// --- Session Complete ---
function SessionComplete({results,data,onFinish}){
  const correctCount=results.filter(r=>r.correct).length;
  const avgTime=results.filter(r=>r.correct).length?
    (results.filter(r=>r.correct).reduce((s,r)=>s+r.time,0)/results.filter(r=>r.correct).length).toFixed(1):0;
  const totalHints=results.reduce((s,r)=>s+r.hints,0);

  return <div className="fade-in text-center py-8">
    <div className="text-5xl mb-4">ğŸ‰</div>
    <h2 className="text-2xl font-extrabold text-gray-900 dark:text-white mb-2">í•™ìŠµ ì™„ë£Œ!</h2>
    <div className="bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-100 dark:border-gray-700 mb-6 text-left">
      <div className="grid grid-cols-2 gap-4">
        <div className="text-center"><p className="text-2xl font-bold text-brand-500">{results.length}</p><p className="text-xs text-gray-400">í•™ìŠµ ë¬¸ì¥</p></div>
        <div className="text-center"><p className="text-2xl font-bold text-safe">{correctCount}</p><p className="text-xs text-gray-400">ì •ë‹µ</p></div>
        <div className="text-center"><p className="text-2xl font-bold text-gray-800 dark:text-gray-200">{avgTime}s</p><p className="text-xs text-gray-400">í‰ê·  íšŒìƒ</p></div>
        <div className="text-center"><p className="text-2xl font-bold text-warn">{totalHints}</p><p className="text-xs text-gray-400">íŒíŠ¸ ì‚¬ìš©</p></div>
      </div>
    </div>
    <p className="text-sm text-gray-500 dark:text-gray-400 mb-6">
      {correctCount===results.length?'ì™„ë²½í•´ìš”! ëª¨ë“  ë¬¸ì¥ì„ ê¸°ì–µí–ˆì–´ìš”.':'ì¡°ê¸ˆ ì–´ë ¤ì› ë˜ ë¬¸ì¥ì€ ê³§ ë‹¤ì‹œ ë‚˜íƒ€ë‚  ê±°ì˜ˆìš”.'}
    </p>
    <button onClick={onFinish} className="w-full py-3.5 rounded-xl bg-brand-500 text-white font-bold">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  </div>;
}

// ============================================================
// APP
// ============================================================
function App(){
  const[data,setData]=useStore();
  const[page,setPage]=useState(data.sessions?.length>0?'home':'landing');
  const dark=data.dark;

  useEffect(()=>{document.documentElement.classList.toggle('dark',dark);},[dark]);

  const toggleDark=()=>setData(d=>({...d,dark:!d.dark}));

  const startSession=()=>{
    // Update streak
    const today=new Date().toDateString();
    const streak=data.streak||{current:0,best:0,lastDate:null};
    let newStreak={...streak};
    if(streak.lastDate!==today){
      const yesterday=new Date(Date.now()-86400000).toDateString();
      if(streak.lastDate===yesterday){newStreak.current++;}
      else if(streak.lastDate!==today){newStreak.current=1;}
      newStreak.lastDate=today;
      newStreak.best=Math.max(newStreak.best,newStreak.current);
    }
    setData(d=>({...d,streak:newStreak}));
    setPage('learning');
  };

  const finishSession=()=>{
    setData(d=>({...d,sessions:[...(d.sessions||[]),{date:Date.now()}]}));
    setPage('home');
  };

  return <div className="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors">
    {page!=='landing'&&<header className="sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-b border-gray-100 dark:border-gray-800">
      <div className="max-w-lg mx-auto px-4 py-3 flex items-center justify-between">
        <div className="flex items-center gap-2 cursor-pointer" onClick={()=>setPage('home')}>
          <span className="text-xl">ğŸ§ </span>
          <span className="text-base font-bold text-gray-800 dark:text-gray-100">SentenceFlow</span>
        </div>
        <DarkToggle dark={dark} toggle={toggleDark}/>
      </div>
    </header>}

    <main className="max-w-lg mx-auto px-4 py-6">
      {page==='landing'&&<Landing onStart={()=>{setPage('home');startSession();}}/>}
      {page==='home'&&<Home data={data} onStartSession={startSession} onShowList={()=>setPage('list')}/>}
      {page==='list'&&<SentenceList data={data} onBack={()=>setPage('home')}/>}
      {page==='learning'&&<LearningSession data={data} setData={setData} onFinish={finishSession}/>}
    </main>

    {page!=='landing'&&page!=='learning'&&<footer className="text-center py-6 text-xs text-gray-300 dark:text-gray-700">
      SentenceFlow â€” í•˜ë£¨ 7ë¶„, ì˜ì–´ê°€ ì…ì—ì„œ ë‚˜ì˜µë‹ˆë‹¤
    </footer>}
  </div>;
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
